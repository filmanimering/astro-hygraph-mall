---
interface Props {
  src: string;
  alt?: string;
  width?: number;
  height?: number;
  class?: string;
  aspect?: "video" | "square" | "auto" | "portrait";
  fit?: "cover" | "contain";
  loading?: "lazy" | "eager";
  priority?: boolean;
}

const {
  src,
  alt = "",
  width,
  height,
  class: className,
  aspect = "video",
  fit = "cover",
  loading = "lazy",
  priority = false,
} = Astro.props;

/**
 * 1. OPTIMERING (Hygraph Transformations)
 * - auto=format: Viktigt för WebP/AVIF (Sparar de där 849 KiB).
 * - quality=75: Standard för webben, minskar filstorleken drastiskt utan synlig förlust.
 * - width: Vi skalar ner bilden på servern så vi inte laddar 1MB i onödan.
 */
const params = new URLSearchParams();
params.append("auto", "format,compress");
params.append("quality", "75");
if (width) params.append("width", width.toString());

// Vi rensar URL:en från eventuella gamla querys för att maxa cache-träffar
const baseUrl = src.split("?")[0];
const optimizedSrc = `${baseUrl}?${params.toString()}`;

const aspectClasses = {
  video: "aspect-video",
  square: "aspect-square",
  portrait: "aspect-[3/4]",
  auto: "aspect-auto",
};

const fitClasses = {
  cover: "object-cover",
  contain: "object-contain",
};
---

<div
  class:list={[
    "relative overflow-hidden bg-slate-200/50 shadow-sm ",
    aspectClasses[aspect],
    className,
  ]}
>
  <img
    src={optimizedSrc}
    alt={optimizedSrc || "Hero bild"}
    width={width}
    height={height}
    loading={priority ? "eager" : loading}
    fetchpriority={priority ? "high" : "auto"}
    decoding={priority ? "sync" : "async"}
    class:list={["w-full h-full", fitClasses[fit]]}
  />
</div>
