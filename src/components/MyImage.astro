---
interface Props {
  src: string;
  alt?: string;
  width?: number;
  height?: number;
  class?: string;
  aspect?: "video" | "square" | "auto" | "portrait";
  fit?: "cover" | "contain";
  loading?: "lazy" | "eager";
  priority?: boolean; // Ny: för LCP-bilder
}

const {
  src,
  alt = "",
  width,
  height,
  class: className,
  aspect = "video",
  fit = "cover",
  loading = "lazy",
  priority = false,
} = Astro.props;

// 1. Optimera URL:en direkt (WebP + Komprimering)
// Vi lägger även till en dynamisk bredd baserat på den inskickade width-propen
const optimizedSrc = `${src}?auto=format,compress${width ? `&w=${width}` : ""}`;

const aspectClasses = {
  video: "aspect-video",
  square: "aspect-square",
  portrait: "aspect-[3/4]",
  auto: "aspect-auto",
};

const fitClasses = {
  cover: "object-cover",
  contain: "object-contain",
};
---

<div
  class:list={[
    "relative overflow-hidden  bg-slate-200/50 shadow-sm rounded-lg",
    aspectClasses[aspect],
    className,
  ]}
>
  <img
    src={optimizedSrc}
    alt={alt}
    width={width}
    height={height}
    loading={priority ? "eager" : loading}
    fetchpriority={priority ? "high" : "auto"}
    class:list={["w-full h-full", fitClasses[fit]]}
  />
</div>
