---
import HeaderLink from "./HeaderLink.astro";
import MyButton from "./MyButton.astro";
import MyImage from "./MyImage.astro";
import Hamburger from "./ikonerSvg/Hamburger.astro";

const { pathname } = Astro.url;
const { settings = {} } = Astro.props;
const { siteName, logo, navigation = [], navigationRight = [] } = settings;
---

<header
  id="top"
  class="glass-panel sticky top-4 z-50 mx-4 xl:mx-28 rounded-xl shadow-lg shadow-slate-900/20 text-black"
>
  <nav class="max-w-8xl mx-auto px-6 h-14 flex items-center justify-between">
    <div class="flex items-center">
      <a href="/" class="flex items-center gap-3 no-underline group">
        {
          logo?.url && (
            <MyImage
              src={logo.url}
              alt={`${siteName} logotyp`}
              width={logo.width || 80}
              height={logo.height || 30}
              aspect="auto"
              fit="contain"
              class="h-5 w-auto bg-transparent border-none shadow-none rounded-sm group-hover:opacity-80 transition-opacity"
            />
          )
        }
        <span
          class="mt-1 text-sm font-semibold text-slate-700 group-hover:opacity-70 transition-opacity"
        >
          {siteName || "Photo and Film"}
        </span>
      </a>
    </div>

    <button
      id="mobile-menu-button"
      type="button"
      class="xl:hidden inline-flex items-center justify-center rounded-lg p-2 text-slate-700 hover:bg-slate-900/5 active:scale-95 transition-all"
      aria-label="Meny"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <Hamburger />
    </button>

    <div class="hidden xl:flex items-center gap-1 md:gap-2">
      {
        navigation.map((link: any) => (
          <HeaderLink
            href={link.url}
            class="px-3 py-1 rounded-xl text-sm active:scale-95"
          >
            {link.label}
          </HeaderLink>
        ))
      }
    </div>
    <div class="hidden xl:flex items-center gap-1 md:gap-2">
      {
        navigationRight.map((linkRight: any) => (
          <a
            href={linkRight.url}
            aria-label={linkRight.label}
            class="text-sm bg-[#685CEF] text-slate-50 py-2 px-3 rounded-lg transition delay-100 duration-150 ease-in-out hover:-translate-y-0.5 hover:scale-101"
          >
            {linkRight.label}
          </a>
        ))
      }
    </div>
  </nav>

  {/* MOBILMENY - Nu med samma glas-effekt som headern */}
  <div
    id="mobile-menu"
    class="xl:hidden hidden absolute top-14 left-0 right-0 bg-white shadow-2xl shadow-slate-900/20 z-50 rounded-2xl overflow-hidden"
  >
    <div class="py-12 flex flex-col gap-1 max-w-sm mx-auto">
      {
        navigation.map((link: any) => {
          const isActive =
            link.url === pathname || link.url === pathname.replace(/\/$/, "");
          return (
            <a
              href={link.url}
              class={`mx-3 py-3 rounded-xl text-center text-lg font-semibold transition-all ${
                isActive
                  ? "bg-slate-900 text-white shadow-md"
                  : "text-slate-900 hover:bg-slate-900/45"
              }`}
            >
              {link.label}
            </a>
          );
        })
      }
      {
        navigationRight.map((link: any) => {
          const isActive =
            link.url === pathname || link.url === pathname.replace(/\/$/, "");
          return (
            <a
              href={link.url}
              class={`px-3 py-3 rounded-lg text-center text-lg font-semibold transition-all ${
                isActive
                  ? "bg-slate-900 text-white shadow-md"
                  : "text-slate-900 hover:bg-slate-900/45"
              }`}
            >
              {link.label}
            </a>
          );
        })
      }
    </div>
  </div>
</header>

<script>
  const btn = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  btn?.addEventListener("click", () => {
    const isExpanded = btn.getAttribute("aria-expanded") === "true";
    btn.setAttribute("aria-expanded", !isExpanded ? "true" : "false");
    menu?.classList.toggle("hidden");
  });

  menu?.addEventListener("click", (e) => {
    if ((e.target as HTMLElement).tagName === "A") {
      menu.classList.add("hidden");
      btn?.setAttribute("aria-expanded", "false");
    }
  });
</script>
