---
import HeaderLink from "./HeaderLink.astro";
import MyImage from "./MyImage.astro";

// --- DATAHÄMTNING (Global Settings) ---
const HYGRAPH_ENDPOINT = import.meta.env.HYGRAPH_ENDPOINT;

const query = `
query GetGlobalSettings {
  globalSettings {  
    logo {
      url
      width
      height
    }
    navigation {
      ... on Navigation {
        id
        label
        url
      }
    }
    siteName
    seo {
      seoTitle
      seoDescription
      ogImage { url }
    }
  }
}`;

const response = await fetch(HYGRAPH_ENDPOINT, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ query }),
});

const json = await response.json();
const settings = json.data?.globalSettings[0] || {};
const { siteName, logo, navigation = [] } = settings;
---

<header
  class="w-full bg-white/70 backdrop-blur-md sticky top-0 z-50 border-b border-slate-100"
>
  <nav class="max-w-8xl mx-auto px-6 h-16 flex items-center justify-between">
    {/* --- VÄNSTER: LOGO & NAMN --- */}
    <div class="flex items-center">
      <a href="/" class="flex items-center gap-3 no-underline group">
        {
          logo?.url && (
            <MyImage
              src={logo.url}
              alt={siteName}
              width={logo.width || 80}
              height={logo.height || 30}
              aspect="auto"
              fit="contain"
              class="h-5 w-auto bg-transparent border-none shadow-none rounded-sm group-hover:opacity-80 transition-opacity"
            />
          )
        }
        <span
          class="mt-1 text-base font-semibold tracking-tight text-slate-900 group-hover:opacity-70 transition-opacity"
        >
          {siteName || "Photo and Film"}
        </span>
      </a>
    </div>

    {/* --- MOBILMENY-KNAPP --- */}
    <button
      id="mobile-menu-button"
      class="md:hidden inline-flex items-center justify-center rounded-lg p-2 text-slate-700 hover:bg-slate-100 active:scale-95 transition-all"
      aria-label="Öppna meny"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    {/* --- DESKTOP-MENY --- */}
    <div class="hidden md:flex items-center gap-1 md:gap-2">
      {
        navigation.length > 0 ? (
          navigation.map((link: any) => (
            <HeaderLink
              href={link.url}
              class="px-3 py-1 rounded-xl text-sm text-slate-800 active:scale-95"
            >
              {link.label}
            </HeaderLink>
          ))
        ) : (
          <p class="text-slate-400 text-xs italic">Inga länkar</p>
        )
      }
    </div>
  </nav>

  {/* --- MOBILMENY (Dropdown) --- */}
  <div
    id="mobile-menu"
    class="md:hidden hidden border-t border-slate-100 bg-white/95 backdrop-blur-md"
  >
    <div class="px-6 py-4 flex flex-col gap-2">
      {
        navigation.map((link: any) => (
          <HeaderLink
            href={link.url}
            class="block w-full px-3 py-2 rounded-lg text-slate-800 hover:bg-slate-100"
          >
            {link.label}
          </HeaderLink>
        ))
      }
    </div>
  </div>
</header>

<script>
  const btn = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  btn?.addEventListener("click", () => {
    menu?.classList.toggle("hidden");
  });
</script>
