---
import HeaderLink from "./HeaderLink.astro";
import MyImage from "./MyImage.astro";
import Hamburger from "./ikonerSvg/Hamburger.astro";

const { pathname } = Astro.url;

// --- DATAHÄMTNING (Global Settings) ---
const HYGRAPH_ENDPOINT = import.meta.env.HYGRAPH_ENDPOINT;

const query = `
query GetGlobalSettings {
  globalSettings {  
    logo {
      url
      width
      height
    }
    navigation {
      ... on Navigation {
        id
        label
        url
      }
    }
    siteName
    seo {
      seoTitle
      seoDescription
      ogImage { url }
    }
  }
}`;

const response = await fetch(HYGRAPH_ENDPOINT, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ query }),
});

const json = await response.json();
const settings = json.data?.globalSettings[0] || {};
const { siteName, logo, navigation = [] } = settings;
---

<header
  class="mx-4 bg-slate-50 lg:mx-24 sticky top-4 z-50 rounded-xl border border-gray-200 shadow-lg shadow-slate-800/20"
>
  <nav class="max-w-8xl mx-auto px-6 h-14 flex items-center justify-between">
    {/* --- VÄNSTER: LOGO & NAMN --- */}
    <div class="flex items-center">
      <a href="/" class="flex items-center gap-3 no-underline group">
        {
          logo?.url && (
            <MyImage
              src={logo.url}
              alt={siteName}
              width={logo.width || 80}
              height={logo.height || 30}
              aspect="auto"
              fit="contain"
              class="h-5 w-auto bg-transparent border-none shadow-none rounded-sm group-hover:opacity-80 transition-opacity"
            />
          )
        }
        <span
          class="mt-1 text-sm font-semibold text-slate-700 group-hover:opacity-70 transition-opacity"
        >
          {siteName || "Photo and Film"}
        </span>
      </a>
    </div>

    {/* --- MOBILMENY-KNAPP --- */}
    <button
      id="mobile-menu-button"
      class="lg:hidden inline-flex items-center justify-center rounded-lg p-2 text-slate-700 hover:bg-gray-800/20 active:scale-95 transition-all"
      aria-label="Öppna meny"
    >
      <Hamburger />
    </button>

    {/* --- DESKTOP-MENY (ORÖRD) --- */}
    <div class="hidden lg:flex items-center gap-1 md:gap-2">
      {
        navigation.length > 0 ? (
          navigation.map((link: any) => (
            <HeaderLink
              href={link.url}
              class="px-3 py-1 rounded-xl text-sm text-slate-800 active:scale-95"
            >
              {link.label}
            </HeaderLink>
          ))
        ) : (
          <p class="text-slate-400 text-xs italic">Inga länkar</p>
        )
      }
    </div>
  </nav>

  {/* --- MOBILMENY (NY DESIGN) --- */}
  <div
    id="mobile-menu"
    class="lg:hidden hidden mt-3 mx-3 rounded-2xl bg-white/80 backdrop-blur-xl border border-white/40 shadow-xl shadow-slate-900/20"
  >
    <div class="py-4 flex flex-col gap-2">
      {
        navigation.map((link: any) => {
          const isActive =
            link.url === pathname || link.url === pathname.replace(/\/$/, "");

          return (
            <a
              href={link.url}
              class={`
                mx-4
                py-3
                rounded-xl
                text-center
                text-lg               
                font-medium
                transition-all
                ${
                  isActive
                    ? "bg-slate-900 text-white shadow-sm"
                    : "text-slate-900 hover:bg-gray-800/20"
                }
              `}
            >
              {link.label}
            </a>
          );
        })
      }
    </div>
  </div>
</header>

<script>
  const btn = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  btn?.addEventListener("click", () => {
    menu?.classList.toggle("hidden");
  });
</script>
