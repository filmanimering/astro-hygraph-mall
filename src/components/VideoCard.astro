---
// src/components/VideoCard.astro
const { videoUrl, poster, videoStyle } = Astro.props;
const isAutoplay = videoStyle === "singleVideoAutoPlay";
---

<div
  class="video-card group bg-slate-950 rounded-2xl overflow-hidden border border-white/5 shadow-xl"
>
  <div
    class:list={[
      "relative aspect-video bg-black overflow-hidden",
      !isAutoplay && "cursor-pointer",
    ]}
    id={!isAutoplay ? "video-wrapper" : undefined}
    data-video-src={videoUrl}
  >
    {
      isAutoplay ? (
        /* Autoplay-l채ge: Rendera videon direkt */
        <video
          src={videoUrl}
          poster={poster}
          autoplay
          muted
          loop
          playsinline
          class="w-full h-full object-cover absolute inset-0 z-30 bg-black pointer-events-none"
        />
      ) : (
        /* Grid-l채ge: Visa bara bilden och play-knappen */
        <div class="placeholder-overlay absolute inset-0 z-20">
          {poster && (
            <img
              src={poster}
              alt=""
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
              loading="lazy"
            />
          )}
          <div class="absolute inset-0 flex items-center justify-center bg-black/10 group-hover:bg-black/30 transition-all">
            <div class="w-14 h-14 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 group-hover:scale-110 transition-transform">
              <div class="w-0 h-0 border-t-8 border-t-transparent border-l-14 border-l-white border-b-8 border-b-transparent ml-1" />
            </div>
          </div>
        </div>
      )
    }
  </div>
</div>

<script>
  function initVideoCards() {
    // Hitta alla wrappers som INTE 채r autoplay (de har id="video-wrapper")
    const wrappers = document.querySelectorAll("#video-wrapper");

    wrappers.forEach((wrapper) => {
      if (wrapper.getAttribute("data-ready")) return;

      wrapper.addEventListener("click", () => {
        const url = (wrapper as HTMLElement).dataset.videoSrc;
        const placeholder = wrapper.querySelector(".placeholder-overlay");

        if (url && placeholder) {
          // Vi skapar video-elementet "p책 flykt" i minnet
          const video = document.createElement("video");
          video.src = url;
          video.className =
            "w-full h-full object-cover absolute inset-0 z-30 bg-black";
          video.autoplay = true;
          video.controls = true;
          video.playsInline = true;

          // Byt ut bilden mot videon
          placeholder.remove();
          wrapper.appendChild(video);
        }
      });
      wrapper.setAttribute("data-ready", "true");
    });
  }

  initVideoCards();
  document.addEventListener("astro:after-swap", initVideoCards);
</script>
