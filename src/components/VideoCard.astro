---
// src/components/VideoCard.astro
import MyImage from "./MyImage.astro"; // Använd din optimerade bildkomponent
const { videoUrl, poster, videoStyle } = Astro.props;
const isAutoplay = videoStyle === "singleVideoAutoPlay";
---

<div
  class="video-card group bg-slate-950 rounded-2xl overflow-hidden
  border border-white/5 shadow-xl shadow-gray-500"
>
  <div
    class:list={[
      "relative aspect-video bg-black overflow-hidden",
      !isAutoplay && "cursor-pointer video-click-wrapper", // Ändrat från id till klass
    ]}
    data-video-src={videoUrl}
  >
    {
      isAutoplay ? (
        <video
          src={videoUrl}
          poster={poster}
          autoplay
          muted
          loop
          playsinline
          class="w-full h-full object-cover absolute inset-0 z-30 bg-black pointer-events-none"
        />
      ) : (
        <div class="placeholder-overlay absolute inset-0 z-20">
          {poster && (
            <MyImage
              src={poster}
              alt={poster?.alt || "Poster bild"}
              width={800}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            />
          )}
          <div class="absolute inset-0 flex items-center justify-center bg-black/10 group-hover:bg-black/30 transition-all">
            <div class="w-14 h-14 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 group-hover:scale-110 transition-transform">
              <div class="w-0 h-0 border-t-8 border-t-transparent border-l-14 border-l-white border-b-8 border-b-transparent ml-1" />
            </div>
          </div>
        </div>
      )
    }
  </div>
</div>

<script>
  function initVideoCards() {
    // Ändrat selector till klass för att hantera flera videor på samma sida
    const wrappers = document.querySelectorAll(".video-click-wrapper");

    wrappers.forEach((wrapper) => {
      if (wrapper.getAttribute("data-ready")) return;

      wrapper.addEventListener("click", () => {
        const url = (wrapper as HTMLElement).dataset.videoSrc;
        const placeholder = wrapper.querySelector(".placeholder-overlay");

        if (url && placeholder) {
          const video = document.createElement("video");
          video.src = url;
          video.className =
            "w-full h-full object-cover absolute inset-0 z-30 bg-black";
          video.autoplay = true;
          video.controls = true;
          video.playsInline = true;

          placeholder.remove();
          wrapper.appendChild(video);
        }
      });
      wrapper.setAttribute("data-ready", "true");
    });
  }

  initVideoCards();
  document.addEventListener("astro:after-swap", initVideoCards);
</script>
